<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="×”×©×£ ×”×•×™×¨×˜×•××œ×™ - ××—×•×œ×œ ××ª×›×•× ×™× ×—×›× ×”××‘×•×¡×¡ ×¢×œ ×‘×™× ×” ××œ××›×•×ª×™×ª. ×”×–×Ÿ ××¦×¨×›×™× ××• ×”×¢×“×¤×•×ª ×ª×–×•× ×ª×™×•×ª ×•×§×‘×œ ××ª×›×•× ×™× ×™×™×—×•×“×™×™× ×•×’×“×•×œ×™×.">
    <meta name="keywords" content="××ª×›×•× ×™×, AI, ×‘×™× ×” ××œ××›×•×ª×™×ª, ×©×£ ×•×™×¨×˜×•××œ×™, ××—×•×œ×œ ××ª×›×•× ×™×, Gemini API">
    <meta property="og:title" content="×”×©×£ ×”×•×™×¨×˜×•××œ×™ - ××—×•×œ×œ ××ª×›×•× ×™× AI">
    <meta property="og:description" content="××—×•×œ×œ ××ª×›×•× ×™× ×—×›× ×”××‘×•×¡×¡ ×¢×œ ×‘×™× ×” ××œ××›×•×ª×™×ª. ×”×–×Ÿ ××¦×¨×›×™× ××• ×”×¢×“×¤×•×ª ×ª×–×•× ×ª×™×•×ª ×•×§×‘×œ ××ª×›×•× ×™× ×™×™×—×•×“×™×™×.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://danielbarber11.github.io/AAA/">
    <meta property="og:site_name" content="×”×©×£ ×”×•×™×¨×˜×•××œ×™">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="×”×©×£ ×”×•×™×¨×˜×•××œ×™ - ××—×•×œ×œ ××ª×›×•× ×™× AI">
    <meta name="twitter:description" content="××—×•×œ×œ ××ª×›×•× ×™× ×—×›× ×”××‘×•×¡×¡ ×¢×œ ×‘×™× ×” ××œ××›×•×ª×™×ª">
    <title>×”×©×£ ×”×•×™×¨×˜×•××œ×™ - ××—×•×œ×œ ××ª×›×•× ×™× AI</title>
    <!-- ×˜×¢×™× ×ª Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ×”×’×“×¨×ª ×¤×•× ×˜ Heebo ×’× ×¨×™ ×•×¢×™×¦×•×‘ ×›×œ×œ×™ -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Heebo:wght@100..900&display=swap');
        body {
            font-family: 'Heebo', sans-serif;
            min-height: 100vh;
            background-color: #ffffff; /* ×¨×§×¢ ×œ×‘×Ÿ */
            transition: all 0.5s ease; /* ××¢×‘×¨ ×—×œ×§ ×œ××¦×‘ × ×’×™×©×•×ª */
            font-size: 1rem; /* ×’×•×“×œ ×’×•×¤×Ÿ ×‘×¡×™×¡×™ ×œ×©×œ×™×˜×ª × ×’×™×©×•×ª */
        }

        /* ×”×¡×¨×ª ×¨×§×¢ ××•× ×¤×© */
        .animated-bg {
            background: none;
            background-color: #ffffff;
        }

        /* ×¢×™×¦×•×‘×™× ×›×œ×œ×™×™× */
        .recipe-output h1 {
            font-size: 2em;
            font-weight: bold;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            border-bottom: 2px solid #db2777; /* ×•×¨×•×“ ×¢××•×§ */
            padding-bottom: 0.25rem;
        }
        .recipe-output h2 {
            font-size: 1.5em;
            font-weight: 600;
            margin-top: 1rem;
            color: #4b5563;
        }
        .recipe-output h3 {
            font-size: 1.25em;
            font-weight: 600;
            margin-top: 1rem;
            color: #1f2937;
        }
        .recipe-output ul, .recipe-output ol {
            list-style-position: outside;
            margin-right: 1.5rem;
            padding-right: 0.5rem;
        }
        .recipe-output li {
            margin-bottom: 0.5rem;
        }
        .loader {
            -webkit-animation: spin 1s linear infinite; /* ×©×™× ×•×™ ×œ-linear ×¢×‘×•×¨ ×¡×™×‘×•×‘ ×—×œ×§ */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        .message-box {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 2000;
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
        }
        .message-box.show {
            opacity: 1;
        }
        /* ×× ×™××¦×™×” ×œ×”×•×¤×¢×ª ×ª×™×‘×ª ×”×—×œ×¤×ª ×¨×›×™×‘×™× */
        .slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* ×¢×™×¦×•×‘ ××œ×™×¤×˜×™ ×œ×›×œ ×”×›×¤×ª×•×¨×™× ×•×©×“×•×ª ×”×§×œ×˜ */
        .recipe-btn, #generate-btn, .action-btn, #submit-substitution-btn, #swap-recipe-btn, #close-cookie-banner, #floating-accessibility-btn {
            border-radius: 9999px; /* ×¦×•×¨×ª ×›×¤×ª×•×¨/××œ×™×¤×¡×” */
            transition: all 0.3s ease;
        }
        #recipe-input, #substitution-input {
            border-radius: 9999px;
        }
        /* ×”×•×¡×¤×ª ××¤×§×˜ ×¨×™×—×•×£ ×¢×“×™×Ÿ ×œ×›×¤×ª×•×¨×™× */
        .recipe-btn:hover, #generate-btn:hover, .action-btn:hover, #submit-substitution-btn:hover, #swap-recipe-btn:hover, #close-cookie-banner:hover, #floating-accessibility-btn:hover {
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
            transform: scale(1.02);
        }

        /* CSS ×¢×‘×•×¨ ××¦×‘ × ×’×™×©×•×ª (×¢×œ ×”-body ×›×•×œ×•) */
        .accessibility-mode {
            filter: invert(100%) hue-rotate(180deg); /* ×”×™×¤×•×š ×¦×‘×¢×™× (× ×™×’×•×“×™×•×ª ×’×‘×•×”×”) */
        }
        .accessibility-mode #message-box, 
        .accessibility-mode .modal-overlay,
        .accessibility-mode #cookie-banner,
        .accessibility-mode #floating-accessibility-btn {
            /* ××•× ×¢ ×”×™×¤×•×š ×©×œ ××œ×× ×˜×™× ×¦×¤×™× */
            filter: none; 
        }
        
        /* CSS ×œ×”×“×’×©×ª ×§×™×©×•×¨×™× */
        .highlight-links a {
            border: 2px solid #ff00ff; /* ×’×‘×•×œ ×•×¨×•×“/×¡×’×•×œ ×‘×•×œ×˜ ×¡×‘×™×‘ ×§×™×©×•×¨×™× */
            padding: 2px 4px;
            background-color: #ff00ff20;
            border-radius: 4px;
        }

        /* CSS ×¢×‘×•×¨ ××•×“×œ ×”×¢×•×’×™×•×ª ×•×”××™×“×¢ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000; /* ×’×‘×•×” ×™×•×ª×¨ ××”×‘×× ×¨ ×•×”×•×“×¢×•×ª */
        }
        .modal-content {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 1.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            animation: fadeIn 0.3s ease-out;
            text-align: right;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* ×¡×’× ×•×Ÿ ×‘×× ×¨ ×¢×•×’×™×•×ª */
        #cookie-banner {
            z-index: 2500; /* ××¢×œ ×›×œ ×”×ª×•×›×Ÿ ××š ××ª×—×ª ×œ××•×“×œ×™× */
            border-top-left-radius: 1.5rem;
            border-top-right-radius: 1.5rem;
            box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.2);
            height: 5rem; /* ×’×•×‘×” ×§×‘×•×¢ ×œ×¦×•×¨×š ×—×™×©×•×‘ ×”× ×’×™×©×•×ª ×‘-JS */
        }
        
        /* ×¡×’× ×•×Ÿ ×›×¤×ª×•×¨ × ×’×™×©×•×ª ×¦×£ - ×©×™××•×© ×‘-JS ×œ×©×œ×™×˜×” ×‘-bottom */
        #floating-accessibility-btn {
            transition: bottom 0.3s ease-out, transform 0.3s ease; /* ×”×•×¡×¤×ª ××¢×‘×¨ ×œ×©×™× ×•×™ ××™×§×•× ×—×œ×§ */
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <!-- ×ª×™×‘×ª ×”×•×“×¢×•×ª (×‘××§×•× alert) -->
    <div id="message-box" class="message-box bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg shadow-xl"></div>

    <!-- ××•×“×œ ×”×’×“×¨×•×ª × ×’×™×©×•×ª -->
    <div id="accessibility-settings-modal" class="modal-overlay">
        <div class="modal-content text-right">
            <h3 class="text-2xl font-bold text-cyan-700 mb-4">â™¿ ×”×’×“×¨×•×ª × ×’×™×©×•×ª</h3>
            <p class="text-gray-700 mb-6">×”×ª×× ××ª ×”×’×“×¨×•×ª ×”×ª×¦×•×’×” ×œ× ×•×—×•×ª ×”×§×¨×™××” ×”××§×¡×™××œ×™×ª (×ª×•×× ×ª×§×Ÿ 5568):</p>
            
            <div class="space-y-4">
                <!-- ×‘×§×¨×ª × ×™×’×•×“×™×•×ª -->
                <div class="p-3 border rounded-lg flex items-center justify-between bg-gray-50">
                    <span class="font-semibold text-gray-800">× ×™×’×•×“×™×•×ª ×’×‘×•×”×” (×”×™×¤×•×š ×¦×‘×¢×™×)</span>
                    <button id="toggle-contrast-btn" class="bg-cyan-500 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-md">
                        ×”×¤×¢×œ × ×™×’×•×“×™×•×ª ×’×‘×•×”×”
                    </button>
                </div>
                
                <!-- ×‘×§×¨×ª ×”×“×’×©×ª ×§×™×©×•×¨×™× -->
                <div class="p-3 border rounded-lg flex items-center justify-between bg-gray-50">
                    <span class="font-semibold text-gray-800">×”×“×’×©×ª ×§×™×©×•×¨×™×</span>
                    <button id="toggle-link-highlight-btn" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-md">
                        ×”×¤×¢×œ ×”×“×’×©×”
                    </button>
                </div>

                <!-- ×‘×§×¨×ª ×’×•×“×œ ×’×•×¤×Ÿ -->
                <div class="p-3 border rounded-lg flex items-center justify-between bg-gray-50">
                    <span class="font-semibold text-gray-800">×’×•×“×œ ×˜×§×¡×˜: <span id="current-font-size">×¨×’×™×œ</span></span>
                    <div class="flex gap-2">
                        <button id="increase-text-btn" class="bg-pink-500 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-md">
                            ×”×’×“×œ ×’×•×¤×Ÿ (+)
                        </button>
                        <button id="decrease-text-btn" class="bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-md">
                            ×”×§×˜×Ÿ ×’×•×¤×Ÿ (-)
                        </button>
                    </div>
                </div>
            </div>

            <div class="flex justify-between mt-6">
                <!-- ×›×¤×ª×•×¨ ××™×¤×•×¡ -->
                <button id="reset-accessibility-btn" class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-lg">
                    ××™×¤×•×¡ ×”×’×“×¨×•×ª
                </button>
                <button id="close-accessibility-settings-btn" class="bg-gray-400 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-lg">
                    ×¡×’×•×¨
                </button>
            </div>
        </div>
    </div>
    
    <!-- ××•×“×œ "×§×¨× ×¢×•×“" (××” ×–×” ×¢×•×’×™×•×ª) -->
    <div id="about-cookies-modal" class="modal-overlay">
        <div class="modal-content text-right">
            <h3 class="text-2xl font-bold text-indigo-700 mb-4">ğŸ“˜ ××”×Ÿ ×¢×•×’×™×•×ª (Cookies)?</h3>
            <p class="text-gray-700 mb-4">
                "×¢×•×’×™×•×ª" ×”×Ÿ ×§×‘×¦×™ ×˜×§×¡×˜ ×§×˜× ×™× ×”×××•×—×¡× ×™× ×‘××›×©×™×¨ ×©×œ×š ×¢×œ ×™×“×™ ×”×“×¤×“×¤×Ÿ. 
                ×”×Ÿ ×¢×•×–×¨×•×ª ×œ××ª×¨ ×œ×–×›×•×¨ ××™×“×¢ ×¢×œ ×”×‘×™×§×•×¨ ×©×œ×š, ×›×’×•×Ÿ ×”×¢×“×¤×•×ª ×××©×§ (×›××• ××¦×‘ × ×’×™×©×•×ª) ××• × ×ª×•× ×™× ×œ×©×™×¤×•×¨ ×‘×™×¦×•×¢×™×.
            </p>
            <p class="text-gray-700 mb-6">
                ×‘××ª×¨ ×–×”, ×”×¢×•×’×™×•×ª ××©××©×•×ª ×‘×¢×™×§×¨ ×œ×¦×•×¨×š ×©××™×¨×ª ×”×¢×“×¤×•×ª ×××©×§ ×•×œ×©×™×¤×•×¨ ×‘×™×¦×•×¢×™ ×”×‘×•×˜ ×•××™×›×•×ª ×”××ª×›×•× ×™× ×”××•×¤×§×™×.
            </p>
            <div class="flex justify-end">
                <button id="close-about-cookies-btn" class="bg-pink-500 hover:bg-pink-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-lg">
                    ×¡×’×•×¨
                </button>
            </div>
        </div>
    </div>

    <!-- ××•×“×œ ×”×¦×”×¨×ª ××–×”×¨×” ×”××§×™×£ (××•×¤×™×¢ ×‘×—×™×¤×•×© ×¨××©×•×Ÿ) -->
    <div id="disclaimer-modal" class="modal-overlay">
        <div class="modal-content text-right">
            <h3 class="text-2xl font-bold text-red-600 mb-4">âš ï¸ ×× × ××©×¨ ××ª ×”×ª× ××™× ×•×”×”×¦×”×¨×•×ª ×”×‘××•×ª</h3>
            <p class="text-gray-700 mb-6">
                ×›×“×™ ×œ×”×©×ª××© ×‘××—×•×œ×œ ×”××ª×›×•× ×™×, ×¢×œ×™×š ×œ××©×¨ ×©×§×¨××ª ×•×”×‘× ×ª ××ª ×›×œ ×ª× ××™ ×”×©×™××•×© ×•×”×”×¦×”×¨×•×ª ×”×¨×œ×•×•× ×˜×™×•×ª:
            </p>
            
            <div class="space-y-3">
                <!-- 1. ×ª× ××™ ×©×™××•×© -->
                <button data-modal="terms-of-use" class="disclaimer-link-btn w-full text-right bg-blue-500/10 hover:bg-blue-500/20 text-blue-800 font-bold py-3 px-4 rounded-lg transition duration-300 shadow-sm">
                    ğŸ“œ ×ª× ××™ ×©×™××•×© ×›×œ×œ×™×™×
                </button>
                <!-- 2. ××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª -->
                <button data-modal="privacy-policy" class="disclaimer-link-btn w-full text-right bg-blue-500/10 hover:bg-blue-500/20 text-blue-800 font-bold py-3 px-4 rounded-lg transition duration-300 shadow-sm">
                    ğŸ”’ ××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª
                </button>
                <!-- 3. ×”×’×‘×œ×ª ××—×¨×™×•×ª ×¨×¤×•××™×ª -->
                <button data-modal="disclaimer" class="disclaimer-link-btn w-full text-right bg-red-500/10 hover:bg-red-500/20 text-red-800 font-bold py-3 px-4 rounded-lg transition duration-300 shadow-sm">
                    âš•ï¸ ×”×’×‘×œ×ª ××—×¨×™×•×ª ×¨×¤×•××™×ª ×•×ª×–×•× ×ª×™×ª
                </button>
                <!-- 4. ×”×¦×”×¨×ª AI -->
                <button data-modal="ai-assurance" class="disclaimer-link-btn w-full text-right bg-indigo-500/10 hover:bg-indigo-500/20 text-indigo-800 font-bold py-3 px-4 rounded-lg transition duration-300 shadow-sm">
                    ğŸ¤– ×”×¦×”×¨×ª ×©×™××•×© ×‘×‘×™× ×” ××œ××›×•×ª×™×ª
                </button>
            </div>

            <div class="flex justify-center mt-8">
                <button id="close-disclaimer-btn" class="bg-green-500 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-full transition duration-300 shadow-lg text-lg">
                    ×× ×™ ×××©×¨/×ª ××ª ×›×œ ×”×ª× ××™×
                </button>
            </div>
        </div>
    </div>
    
    <!-- ××•×“×œ ×”×¦×”×¨×ª ×©×™××•×© ×‘-AI (× ×¤×ª×— ××”××•×“×œ ×”××§×™×£) -->
    <div id="ai-assurance-modal" class="modal-overlay">
        <div class="modal-content text-right">
            <h3 class="text-2xl font-bold text-indigo-600 mb-4">ğŸ¤– ×”×¦×”×¨×ª ×©×™××•×© ×‘×‘×™× ×” ××œ××›×•×ª×™×ª ××ª×§×“××ª</h3>
            <p class="text-gray-700 mb-4">
                ×”×©×£ ×”×•×™×¨×˜×•××œ×™ ××•×¤×¢×œ ×¢×œ ×™×“×™ ××•×“×œ ×”×‘×™× ×” ×”××œ××›×•×ª×™×ª <span class="font-extrabold text-pink-600">×”×˜×•×‘ ×‘×™×•×ª×¨</span> ×©×œ ×’×•×’×œ - <span class="font-extrabold text-blue-600">Gemini</span> - ×‘×©×™×œ×•×‘ ×¢× ×—×™×¤×•×© ×’×•×’×œ ×¢×“×›× ×™. 
                ×× ×• ××©×ª××©×™× ×‘×˜×›× ×•×œ×•×’×™×” ×–×• ×›×“×™ ×œ×”×‘×˜×™×— ××ª×›×•× ×™× ××™×›×•×ª×™×™×, ×™×¦×™×¨×ª×™×™× ×•××“×•×™×§×™× ×›×›×œ ×”××¤×©×¨.
            </p>
            <p class="text-gray-700 mb-6 font-bold">
                **×—×©×•×‘:** ×××—×¨ ×©×”××ª×›×•× ×™× × ×•×¦×¨×™× ×‘××•×¤×Ÿ ×’× ×¨×˜×™×‘×™, ×”××™×“×¢ ×”××ª×§×‘×œ ××™× ×• ××•×‘×˜×— ×›×©×œ× ××• × ×›×•×Ÿ ×‘-100%. ×× × ×”×©×ª××©×• ×‘×©×™×§×•×œ ×“×¢×ª ×•×‘×—× ×• ××ª ×”××ª×›×•× ×™× ×œ×¤× ×™ ×”×”×›× ×”.
            </p>
            <div class="flex justify-end">
                <button data-modal="ai-assurance" class="close-modal-btn bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-lg">
                    ×¡×’×•×¨
                </button>
            </div>
        </div>
    </div>
    
    <!-- ××•×“×œ ×ª× ××™ ×©×™××•×© (×—×“×©) -->
    <div id="terms-of-use-modal" class="modal-overlay">
        <div class="modal-content text-right">
            <h3 class="text-2xl font-bold text-blue-600 mb-4">ğŸ“œ ×ª× ××™ ×©×™××•×©</h3>
            <p class="text-gray-700 mb-4">
                ×”×©×™××•×© ×‘××ª×¨ ×–×”, ×œ×¨×‘×•×ª ×›×œ ×ª×•×›×Ÿ, ×ª×›×•× ×” ××• ×©×™×¨×•×ª ×”××•×¦×¢×™× ×“×¨×›×•, ×›×¤×•×£ ×œ×”×¡×›××ª×š ×œ×›×œ ×”×ª× ××™× ×”××¤×•×¨×˜×™× ×œ×”×œ×Ÿ.
            </p>
            <p class="text-gray-700 mb-6">
                ×”×©×™×¨×•×ª × ×™×ª×Ÿ "×›××•×ª ×©×”×•×" ×•×œ×œ× ××—×¨×™×•×ª ××›×œ ×¡×•×’. ×—×œ ××™×¡×•×¨ ×¢×œ ×©×™××•×© ××¡×—×¨×™ ×œ×œ× ××™×©×•×¨ ××¤×•×¨×© ××¨××©.
            </p>
            <div class="flex justify-end">
                <button data-modal="terms-of-use" class="close-modal-btn bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-lg">
                    ×¡×’×•×¨
                </button>
            </div>
        </div>
    </div>
    
    <!-- ××•×“×œ ××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª (×—×“×©) -->
    <div id="privacy-policy-modal" class="modal-overlay">
        <div class="modal-content text-right">
            <h3 class="text-2xl font-bold text-blue-600 mb-4">ğŸ”’ ××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª</h3>
            <p class="text-gray-700 mb-4">
                ×”××ª×¨ ××•×¡×£ ××™×“×¢ ×× ×•× ×™××™ ×¢×œ ×©×™××•×© ×œ×¦×•×¨×š ×©×™×¤×•×¨ ×”×©×™×¨×•×ª ×•×”×¦×’×ª ×ª×•×›×Ÿ ×¨×œ×•×•× ×˜×™.
            </p>
            <p class="text-gray-700 mb-6">
                ×›×œ ×”××™×“×¢ ×”××™×©×™ ×©× ××¡×¨ ×¢×œ ×™×“×š (×›×›×œ ×©×™×©× ×•) ×™×™×©××¨ ×‘×¡×•×“×™×•×ª ×•×œ× ×™×•×¢×‘×¨ ×œ×¦×“×“×™× ×©×œ×™×©×™×™×, ××œ× ×× × ×“×¨×© ×¢×œ ×¤×™ ×—×•×§. ×× ×• ××©×ª××©×™× ×‘×¢×•×’×™×•×ª ×œ×©×™×¤×•×¨ ×—×•×•×™×™×ª ×”××©×ª××©.
            </p>
            <div class="flex justify-end">
                <button data-modal="privacy-policy" class="close-modal-btn bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-lg">
                    ×¡×’×•×¨
                </button>
            </div>
        </div>
    </div>
    
    <!-- ××•×“×œ ×”×’×‘×œ×ª ××—×¨×™×•×ª ×¨×¤×•××™×ª ×•×ª×–×•× ×ª×™×ª -->
    <div id="medical-disclaimer-modal" class="modal-overlay">
        <div class="modal-content text-right">
            <h3 class="text-2xl font-bold text-red-600 mb-4">âš•ï¸ ×”×’×‘×œ×ª ××—×¨×™×•×ª ×¨×¤×•××™×ª ×•×ª×–×•× ×ª×™×ª</h3>
            <p class="text-gray-700 mb-4 font-bold">
                ×”××ª×¨ ××™× ×• ××”×•×•×” ×™×™×¢×•×¥ ×¨×¤×•××™, ×ª×–×•× ×ª×™ ××• ×‘×˜×™×—×•×ª×™.
            </p>
            <p class="text-gray-700 mb-4">
                ×—×•×‘×” ×¢×œ ×”××©×ª××© ×œ×•×•×“× ××ª ×“×™×•×§ ×”××¨×›×™×‘×™×, ×”×‘×˜×™×—×•×ª ×”×ª×–×•× ×ª×™×ª ×•×”×ª×××” ×œ××’×‘×œ×•×ª ×‘×¨×™××•×ª×™×•×ª (×›×’×•×Ÿ ××œ×¨×’×™×•×ª, ×¨×’×™×©×•×™×•×ª ××• ××¦×‘×™× ×¨×¤×•××™×™×). 
                ×‘×›×œ ××§×¨×” ×©×œ ×¡×¤×§, ×™×© ×œ×”×ª×™×™×¢×¥ ×¢× ××™×© ××§×¦×•×¢ ××•×¡××š (×“×™××˜×Ÿ ×§×œ×™× ×™, ×¨×•×¤×). 
                ×”×©×™××•×© ×‘××ª×¨ ×”×•× ×¢×œ ××—×¨×™×•×ª ×”××©×ª××© ×‘×œ×‘×“.
            </p>
            <div class="flex justify-end">
                <button data-modal="disclaimer" class="close-modal-btn bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-full transition duration-300 shadow-lg">
                    ×¡×’×•×¨
                </button>
            </div>
        </div>
    </div>

    
    <!-- ×œ×—×¦×Ÿ × ×’×™×©×•×ª ×¦×£ - ×‘×¤×™× ×” ×”×©×××œ×™×ª ×”×ª×—×ª×•× ×” - ××™×§×•× ×“×™× ××™ -->
    <button id="floating-accessibility-btn" class="fixed left-4 bg-cyan-500 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-full shadow-2xl z-40 transition duration-300 transform hover:scale-110" style="bottom: 1rem;">
        × ×’×™×©×•×ª
    </button>


    <!-- ×”×§×•× ×˜×™×™× ×¨ ×”×¨××©×™ -->
    <div class="max-w-6xl mx-auto bg-white shadow-2xl rounded-3xl overflow-hidden transform transition duration-500 hover:shadow-pink-500/50" id="main-container">
        
        <!-- ×›×•×ª×¨×ª ×¨××©×™×ª - ×¡×’×•×œ ×›×”×” -->
        <header class="bg-indigo-700/90 backdrop-blur-sm p-6 text-white text-center rounded-t-3xl shadow-lg">
            <h1 class="text-3xl font-extrabold tracking-tight">×”×©×£ ×”×•×™×¨×˜×•××œ×™</h1>
            <p class="mt-1 text-lg font-light">××—×•×œ×œ ××ª×›×•× ×™× ××•× ×¢ ×‘×™× ×” ××œ××›×•×ª×™×ª</p>
        </header>

        <!-- ××–×•×¨ ×”×©××œ×•×ª ×”××•×’×“×¨×•×ª ××¨××© -->
        <section class="p-6 border-b border-gray-100 bg-white/70 backdrop-blur-sm">
            <h2 class="text-xl font-semibold text-gray-800 mb-4 text-center">×‘×—×¨ ××ª×›×•×Ÿ ×‘×œ×—×™×¦×” ××• ×”×§×œ×“ ×©××œ×” ××©×œ×š:</h2>
            <div id="quick-buttons" class="flex flex-wrap justify-center gap-3">
                <!-- ×”×›×¤×ª×•×¨×™× ×™×•×¦×¨×• ×›××Ÿ ×‘××•×¤×Ÿ ×“×™× ××™ ×¢×œ ×™×“×™ JS -->
            </div>
        </section>

        <!-- ××–×•×¨ ×”×§×œ×˜ (×‘×•×˜) -->
        <section class="p-6 bg-white/70 backdrop-blur-sm">
            <div class="flex flex-col sm:flex-row gap-3">
                <!-- ×©×•×¨×ª ×§×œ×˜ ××œ×™×¤×˜×™×ª -->
                <input type="text" id="recipe-input" placeholder="×œ×“×•×’××”: ××ª×›×•×Ÿ ×œ×§×¦×™×¦×•×ª ×“×’×™× ×‘×¨×•×˜×‘ ×¢×’×‘× ×™×•×ª" 
                       class="flex-grow p-3 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-fuchsia-500 text-right shadow-md">
                
                <!-- ×›×¤×ª×•×¨ ×—×™×¤×•×© - ×›×—×•×œ -->
                <button id="generate-btn" 
                        class="bg-blue-600 hover:bg-blue-800 text-white font-bold py-3 px-6 shadow-xl flex-shrink-0 flex items-center justify-center">
                    <span id="btn-text">×—×¤×© ××ª×›×•×Ÿ</span>
                    <div id="loader" class="hidden loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6 ml-2"></div>
                </button>
            </div>
        </section>

        <!-- ××–×•×¨ ×›×¤×ª×•×¨×™ ×¤×¢×•×œ×” - ×¨××©×™ - ×›×¤×ª×•×¨ ×¢×•×’×™×•×ª ×”×•×¡×¨ -->
        <section class="p-6 pt-0 bg-white/70 backdrop-blur-sm border-t border-gray-100 hidden" id="recipe-actions">
            <div class="flex flex-wrap justify-center gap-3" id="main-actions">
                <button id="copy-btn" disabled class="action-btn bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 shadow-md">
                    ×”×¢×ª×§ ××ª×›×•×Ÿ
                </button>
                <button id="shorten-btn" disabled class="action-btn bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 shadow-md">
                    ×§×¦×¨ ××ª×›×•×Ÿ
                </button>
                <!-- ×›×¤×ª×•×¨ ×”×—×œ×£ ×¨×›×™×‘×™× ×”××§×•×¨×™ - ×¡×’×•×œ -->
                <button id="substitute-toggle-btn" disabled class="action-btn bg-purple-600 hover:bg-purple-800 text-white font-bold py-2 px-4 shadow-xl">
                    ×”×—×œ×£ ×¨×›×™×‘×™× ğŸ”„
                </button>
            </div>

            <!-- ×§×•× ×˜×™×™× ×¨ ×”×—×œ×¤×ª ×¨×›×™×‘×™× ×•××ª×›×•× ×™× - × ×¡×ª×¨ ×‘×”×ª×—×œ×” -->
            <div id="substitute-input-container" class="flex flex-col sm:flex-row gap-3 mt-4 hidden slide-in">
                <!-- ×©×•×¨×ª ×§×œ×˜ ××œ×™×¤×˜×™×ª -->
                <input type="text" id="substitution-input" placeholder="××™×œ×• ×¨×›×™×‘×™× ×ª×¨×¦×” ×œ×”×—×œ×™×£? (×œ×“×•×’××”: ×œ×œ× ×’×œ×•×˜×Ÿ, ×˜×‘×¢×•× ×™)" 
                       class="flex-grow p-3 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-purple-500 text-right shadow-md">
                
                <!-- ×›×¤×ª×•×¨ ×”×—×œ×£ ×¨×›×™×‘×™× (×¡××‘××™×˜) - ×¡×’×•×œ -->
                <button id="submit-substitution-btn" 
                        class="bg-purple-600 hover:bg-purple-800 text-white font-bold py-3 px-6 shadow-xl flex-shrink-0">
                    ×”×—×œ×£ ×¨×›×™×‘×™×
                </button>
                
                <!-- ×›×¤×ª×•×¨ ××ª×›×•×Ÿ ××—×¨ - ×•×¨×•×“ -->
                <button id="swap-recipe-btn" 
                        class="bg-pink-500 hover:bg-pink-700 text-white font-bold py-3 px-6 shadow-xl flex-shrink-0">
                    ××ª×›×•×Ÿ ××—×¨ ×œ××•×ª×” ×× ×”
                </button>
            </div>
        </section>
        
        <!-- ××–×•×¨ ×¤×œ×˜ ×”××ª×›×•×Ÿ -->
        <section class="p-6 bg-white/90 min-h-[300px] rounded-b-3xl">
            <div id="recipe-output" class="recipe-output text-gray-700 leading-relaxed">
                <p class="text-center text-gray-500 mt-20">ğŸ‘‹ ×× ×™ ×”×©×£ ×”×•×™×¨×˜×•××œ×™ ×©×œ×›×! ×”×–×™× ×• ×‘×§×©×” ××• ×‘×—×¨×• ×›×¤×ª×•×¨ ×›×“×™ ×œ×§×‘×œ ××ª×›×•×Ÿ ××¤×•×¨×˜.</p>
            </div>
        </section>

    </div>
    
    <!-- ×‘×× ×¨ ×”×ª×¨×¢×ª ×¢×•×’×™×•×ª ×§×‘×•×¢ - ×¡×“×¨ ×”××œ×× ×˜×™× ×©×•× ×” -->
    <div id="cookie-banner" class="fixed bottom-0 right-0 left-0 bg-gray-900 text-white p-4 text-center z-2500 flex flex-wrap justify-center items-center gap-3 hidden">
        <p class="text-sm">
            ×¢×œ ×™×“×™ ×”××©×š ×”×’×œ×™×©×” ×‘××ª×¨, ××ª×” ××‘×™×¢ ××ª ×”×¡×›××ª×š ×œ×©×™××•×© ×‘×¢×•×’×™×•×ª. 
            <a href="#" id="read-more-link" class="text-cyan-400 font-bold hover:text-cyan-600 underline transition duration-300">×§×¨× ×¢×•×“</a>.
        </p>
        <!-- ×”×œ×—×¦×Ÿ ×¢×‘×¨ ×œ×¦×“ ×©×××œ -->
        <button id="close-cookie-banner" class="bg-blue-600 hover:bg-blue-800 text-white font-bold py-1 px-4 rounded-full transition duration-300 shadow-lg text-sm">
            ×× ×™ ××¡×›×™×/×”
        </button>
    </div>
    
    <!-- ×›×•×ª×¨×ª ×ª×—×ª×•× ×” (Footer) - ×“×¨×™×©×ª ×ª××™××•×ª -->
    <footer class="mt-8 mb-4 text-center text-xs text-gray-500 max-w-6xl mx-auto">
        <p>&copy; 2024 ×”×©×£ ×”×•×™×¨×˜×•××œ×™. ×›×œ ×”×–×›×•×™×•×ª ×©××•×¨×•×ª. </p>
        <div class="mt-1 space-x-4 space-x-reverse">
            <!-- ×§×™×©×•×¨×™× ×œ××•×“×œ×™× -->
            <a href="#" class="hover:text-pink-500" data-link="terms-of-use">×ª× ××™ ×©×™××•×©</a>
            <a href="#" class="hover:text-pink-500" data-link="privacy-policy">××“×™× ×™×•×ª ×¤×¨×˜×™×•×ª</a>
            <a href="#" class="hover:text-pink-500" data-link="accessibility-statement">×”×¦×”×¨×ª × ×’×™×©×•×ª</a>
            <a href="#" class="hover:text-red-500 font-bold" data-link="disclaimer">×”×’×‘×œ×ª ××—×¨×™×•×ª ×¨×¤×•××™×ª</a>
            <a href="#" class="hover:text-indigo-500 font-bold" data-link="ai-assurance">×”×¦×”×¨×ª AI</a>
        </div>
        <p class="mt-1">×”××ª×¨ ×¤×•×ª×— ×‘×”×ª×× ×œ×”×•×¨××•×ª × ×’×™×©×•×ª ×”××¨×—×‘ ×”×“×™×’×™×˜×œ×™ (×ª"×™ 5568 ×‘×¨××ª AA).</p>
    </footer>

    <script>
        // ×”×’×“×¨×•×ª ×’×œ×•×‘×œ×™×•×ª ×•-API
        // ×§×‘×™×¢×ª ×”××¤×ª×— ×‘-localStorage ×‘×˜×¢×™× ×” ×¨××©×•× ×™×ª
        const GEMINI_API_KEY = 'AIzaSyCOXoiJn9FpQsi1elLIPRUTb5-go0xdXIM';
        
        // ×”× ×— ×”××¤×ª×— ×‘-localStorage ×× ×¢×“×™×™×Ÿ ××™× ×• ×©×
        if (!localStorage.getItem('gemini_api_key')) {
            localStorage.setItem('gemini_api_key', GEMINI_API_KEY);
        }
        
        let apiKey = localStorage.getItem('gemini_api_key');
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
        
        // --- ××¦×‘ (State) ×’×œ×•×‘×œ×™ ---
        let lastSuccessfulPrompt = '';
        let isHighContrast = false; // ××¦×‘ × ×’×™×©×•×ª
        let isLinkHighlight = false; // ×”×“×’×©×ª ×§×™×©×•×¨×™×
        let fontSizeScale = 1.0; // ×’×•×“×œ ×’×•×¤×Ÿ ×‘×¡×™×¡×™
        // ×©×™× ×•×™ ×§×˜×Ÿ: ×”×¡×›××ª ×¢×•×’×™×•×ª ×™×›×•×œ×” ×œ×”×ª×—×™×œ ×›-false
        let consentGiven = false; 
        // ×©×™× ×•×™ ×§×˜×Ÿ: ×”×¡×›××ª ××–×”×¨×ª ××—×¨×™×•×ª ×¦×¨×™×›×” ×œ×”×ª×—×™×œ ×›-false
        let disclaimerAccepted = false; 

        // ×§×‘×•×¢×™ ××™×§×•× × ×’×™×©×•×ª
        const ACCESSIBILITY_BOTTOM_DEFAULT = '1rem'; // bottom-4
        const ACCESSIBILITY_BOTTOM_ABOVE_COOKIE = '6rem'; // ××¢×œ ×”×‘×× ×¨ ×©×œ 5rem

        // ×××’×¨ ××ª×›×•× ×™× ×œ×‘×—×™×¨×” ××§×¨××™×ª
        const RECIPE_POOL = [
            { text: "××ª×›×•×Ÿ ×œ×¤× ×§×™×™×§ ğŸ¥", recipe: "××ª×›×•×Ÿ ×œ×¤× ×§×™×™×§ ××•×•×¨×™×¨×™" },
            { text: "×¢×•×’×ª ×©×•×§×•×œ×“ ğŸ‚", recipe: "××ª×›×•×Ÿ ×œ×¢×•×’×ª ×©×•×§×•×œ×“ ×¢×©×™×¨×”" },
            { text: "×—×•××•×¡ ×‘×™×ª×™ ğŸ¥™", recipe: "××ª×›×•×Ÿ ×œ×—×•××•×¡ ×‘×™×ª×™" },
            { text: "××¨×§ ×™×¨×§×•×ª ğŸ²", recipe: "××ª×›×•×Ÿ ×¤×©×•×˜ ×œ××¨×§ ×™×¨×§×•×ª" },
            { text: "×œ×–× ×™×” ×‘×©×¨×™×ª ×§×œ××¡×™×ª ğŸ", recipe: "××ª×›×•×Ÿ ×œ×œ×–× ×™×” ×‘×©×¨×™×ª ×§×œ××¡×™×ª" },
            { text: "×¡×œ×˜ ×§×™× ×•××” ××¨×¢× ×Ÿ ğŸ¥—", recipe: "××ª×›×•×Ÿ ×œ×¡×œ×˜ ×§×™× ×•××” ×¢× ×™×¨×§×•×ª ×©×•×¨×©" },
            { text: "×¢×•×’×™×•×ª ×©×•×§×•×œ×“ ×¦'×™×¤×¡ ğŸª", recipe: "××ª×›×•×Ÿ ×§×œ××¡×™ ×œ×¢×•×’×™×•×ª ×©×•×§×•×œ×“ ×¦'×™×¤×¡" },
            { text: "×¤×¡×˜×” ××œ×™-××•×œ×™×• ğŸ", recipe: "××ª×›×•×Ÿ ×œ×¤×¡×˜×” ××œ×™-××•×œ×™×• ×§×œ×™×œ×”" },
        ];
        
        // ×××’×¨ ×©××œ×•×ª ×œ-Placeholder
        const PLACEHOLDER_POOL = [
            "×™×© ×œ×™ 3 ××¨×›×™×‘×™× (×¢×’×‘× ×™×•×ª, ×‘×¦×œ, ×©×•×), ×ª××¦× ××ª×›×•×Ÿ ××ª××™×...",
            "××ª×›×•×Ÿ ×˜×‘×¢×•× ×™ ××”×™×¨ ×•×§×œ?",
            "××” ××¤×©×¨ ×œ×‘×©×œ ×¢× ×¢×•×£ ×•×§×™× ×•××”?",
            "××ª×›×•×Ÿ ×§×™× ×•×— ×¤×¨×•×•×” ×œ×œ× ×’×œ×•×˜×Ÿ...",
            "××ª×›×•×Ÿ ×’×•×¨××” ×©××›×™× ×™× ×‘×¤×—×•×ª ×-20 ×“×§×•×ª?",
            "×¨×¢×™×•×Ÿ ×œ××¨×•×—×ª ×‘×•×§×¨ ×‘×¨×™××” ×¢× ×‘×™×¦×™×?",
            "××¤×™×™×”: ××ª×›×•×Ÿ ×œ×œ×—× ××—××¦×ª ×§×œ ×œ××ª×—×™×œ×™×...",
        ];


        // ××œ×× ×˜×™× ×‘-DOM
        const recipeInput = document.getElementById('recipe-input');
        const generateBtn = document.getElementById('generate-btn');
        const btnText = document.getElementById('btn-text');
        const loader = document.getElementById('loader');
        const recipeOutput = document.getElementById('recipe-output');
        const quickButtonsContainer = document.getElementById('quick-buttons'); // ×©×™××•×© ×‘-Container
        const recipeActions = document.getElementById('recipe-actions');
        const copyBtn = document.getElementById('copy-btn');
        const shortenBtn = document.getElementById('shorten-btn');
        const substituteToggleBtn = document.getElementById('substitute-toggle-btn'); 
        const messageBox = document.getElementById('message-box');
        
        // ××œ×× ×˜×™× ×œ×”×—×œ×¤×ª ×¨×›×™×‘×™×
        const substituteInputContainer = document.getElementById('substitute-input-container');
        const substitutionInput = document.getElementById('substitution-input');
        const submitSubstitutionBtn = document.getElementById('submit-substitution-btn');
        const swapRecipeBtn = document.getElementById('swap-recipe-btn');
        
        // ××œ×× ×˜×™× ×œ× ×’×™×©×•×ª ×•×¢×•×’×™×•×ª
        const floatingAccessibilityBtn = document.getElementById('floating-accessibility-btn'); // ×œ×—×¦×Ÿ ×¦×£
        const accessibilitySettingsModal = document.getElementById('accessibility-settings-modal');
        const closeAccessibilityBtn = document.getElementById('close-accessibility-settings-btn');
        const toggleContrastBtn = document.getElementById('toggle-contrast-btn');
        const toggleLinkHighlightBtn = document.getElementById('toggle-link-highlight-btn'); 
        const increaseTextBtn = document.getElementById('increase-text-btn');
        const decreaseTextBtn = document.getElementById('decrease-text-btn');
        const currentFontSizeSpan = document.getElementById('current-font-size');
        const resetAccessibilityBtn = document.getElementById('reset-accessibility-btn'); 

        // ××œ×× ×˜×™× ×œ×‘×× ×¨ ×”×¢×•×’×™×•×ª
        const cookieBanner = document.getElementById('cookie-banner');
        const closeCookieBannerBtn = document.getElementById('close-cookie-banner');
        const readMoreLink = document.getElementById('read-more-link');
        const aboutCookiesModal = document.getElementById('about-cookies-modal');
        const closeAboutCookiesBtn = document.getElementById('close-about-cookies-btn');
        
        // ××œ×× ×˜×™× ××©×¤×˜×™×™×
        const mainDisclaimerModal = document.getElementById('disclaimer-modal');
        const closeDisclaimerBtn = document.getElementById('close-disclaimer-btn'); // ×›×¤×ª×•×¨ "×× ×™ ×××©×¨/×ª ××ª ×›×œ ×”×ª× ××™×"
        
        const aiAssuranceModal = document.getElementById('ai-assurance-modal');
        const termsOfUseModal = document.getElementById('terms-of-use-modal');
        const privacyPolicyModal = document.getElementById('privacy-policy-modal');
        const medicalDisclaimerModal = document.getElementById('medical-disclaimer-modal');
        
        const disclaimerLinkBtns = document.querySelectorAll('.disclaimer-link-btn');
        const footerLinks = document.querySelectorAll('footer a');
        const closeModalBtns = document.querySelectorAll('.close-modal-btn');


        // ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×œ×”×¦×’×ª ×”×•×“×¢×•×ª ×‘××§×•× alert
        function showMessage(text, isError = false) {
            messageBox.textContent = text;
            messageBox.className = 'message-box show';
            if (isError) {
                messageBox.classList.add('bg-red-100', 'border-red-400', 'text-red-700');
                messageBox.classList.remove('bg-green-100', 'border-green-400', 'text-green-700');
            } else {
                messageBox.classList.add('bg-green-100', 'border-green-400', 'text-green-700');
                messageBox.classList.remove('bg-red-100', 'border-red-400', 'text-red-700');
            }
            setTimeout(() => {
                messageBox.classList.remove('show');
            }, 3000);
        }

        // ×¤×•× ×§×¦×™×™×ª ×¢×–×¨ ×œ×”××¨×ª Markdown ×œ-HTML ×‘×¡×™×¡×™
        function markdownToHtml(markdown) {
            let html = markdown;

            // ×”×—×œ×¤×ª ×›×•×ª×¨×•×ª
            html = html.replace(/^### (.*$)/gim, '<h3>$1</h3>');
            html = html.replace(/^## (.*$)/gim, '<h2>$1</h2>');
            html = html.replace(/^# (.*$)/gim, '<h1>$1</h1>');

            // ×”×—×œ×¤×ª ×¨×©×™××•×ª ×œ× ××¡×•×“×¨×•×ª (××¨×›×™×‘×™×)
            html = html.replace(/^\* (.*$)/gim, '<li>$1</li>');
            // ×¢×•×˜×£ ××ª ×›×œ ×”-li ×‘×¨×©×™××” ×œ× ××¡×•×“×¨×ª
            html = html.replace(/(?:<li>.*<\/li>\n?)+/g, (match) => {
                const isOrdered = match.match(/^\s*\d+\.\s/m);
                if (!isOrdered) {
                    if (match.includes('<ul')) return match; 
                    return '<ul class="list-disc pr-5 mt-2' + '">' + match.replace(/<\/??li>/g, '').split('\n').filter(line => line.trim()).map(line => `<li>${line.trim().replace(/^\*\s*/, '')}</li>`).join('') + '</ul>';
                }
                return match;
            });
            
            // ×”×—×œ×¤×ª ×¨×©×™××•×ª ××¡×•×“×¨×•×ª (×”×•×¨××•×ª)
            html = html.replace(/^\d+\. (.*$)/gim, '<li>$1</li>');
            html = html.replace(/(?:<li>.*<\/li>\n?)+/g, (match) => {
                const isOrdered = match.match(/^\s*\d+\.\s/m);
                if (isOrdered) {
                    return '<ol class="list-decimal pr-5 mt-2">' + match.replace(/<\/??li>/g, '').split('\n').filter(line => line.trim()).map(line => `<li>${line.trim().replace(/^\d+\.\s*/, '')}</li>`).join('') + '</ol>';
                }
                return match;
            });
            
            // ×”×¡×¨×ª ×¤×¡×§××•×ª ×¨×™×§×•×ª ×•×¡×“×¨×ª ×©×•×¨×•×ª
            html = html.replace(/\n\n/g, '<br><br>');
            html = html.replace(/\n/g, '<br>');
            
            return html;
        }

        // ×¤×•× ×§×¦×™×™×ª ×§×¨×™××” ×œ-Gemini API
        async function callGeminiApi(prompt, specificSystemPrompt = null) {
            
            // ×× ×–×• ×”×¤×¢× ×”×¨××©×•× ×” ×©×× ×¡×™× ×œ×—×¤×© ××ª×›×•×Ÿ, ×”×¦×’ ××ª ××•×“×œ ×”××™×©×•×¨ ×”××§×™×£
            if (!disclaimerAccepted) {
                mainDisclaimerModal.style.display = 'flex'; // ×”×¦×’×ª ×”××•×“×œ
                // × ×©××•×¨ ××ª ×”×¤×¨×•××¤×˜ ×›×“×™ ×©× ×•×›×œ ×œ×—×–×•×¨ ××œ×™×• ×œ××—×¨ ×”××™×©×•×¨
                recipeInput.value = prompt; 
                return; // ×™×¦×™××” ××”×¤×•× ×§×¦×™×” ×¢×“ ×œ××™×©×•×¨
            }

            // ××™×¤×•×¡ ×©×“×” ×”×§×œ×˜ ×œ××—×¨ ×©×”××ª×›×•×Ÿ × ×©×œ×—
            recipeInput.value = '';

            // ×”×¦×’×ª ××¦×‘ ×˜×¢×™× ×” ×•×›×™×‘×•×™ ×›×¤×ª×•×¨×™×
            btnText.textContent = '';
            loader.classList.remove('hidden');
            generateBtn.disabled = true;
            copyBtn.disabled = true;
            shortenBtn.disabled = true;
            substituteToggleBtn.disabled = true;
            floatingAccessibilityBtn.disabled = true; // ×›×™×‘×•×™ ×”×›×¤×ª×•×¨ ×”×¦×£
            recipeActions.classList.add('hidden'); // ×”×¡×ª×¨×ª ×›×¤×ª×•×¨×™ ×”×¤×¢×•×œ×” ×‘×–××Ÿ ×˜×¢×™× ×”
            substituteInputContainer.classList.add('hidden'); // ×”×¡×ª×¨×ª ×©×•×¨×ª ×”×”×—×œ×¤×”

            // ××—×•×•×Ÿ ×˜×¢×™× ×” (×—×¦×™ ×¢×™×’×•×œ ××¡×ª×•×‘×‘)
            recipeOutput.innerHTML = `
                <div class="text-center p-8">
                    <!-- ×¡×¤×™× ×¨ ×—×¦×™ ×¢×™×’×•×œ -->
                    <div class="loader ease-linear rounded-full border-4 border-gray-300 border-t-4 border-pink-500 h-12 w-12 mx-auto"></div>
                    <p class="mt-4 text-pink-500 font-medium">×”×©×£ ×”×•×™×¨×˜×•××œ×™ ××›×™×Ÿ ××ª ×”××ª×›×•×Ÿ...</p>
                </div>
            `;


            // ×”×“×¨×›×” ×—×“×©×”: ×× ×”×‘×§×©×” ××™× ×” ××ª×›×•×Ÿ, ×¡×¤×§ ×ª×©×•×‘×” ×¡×¤×¦×™×¤×™×ª
            const defaultSystemPrompt = `××ª×” ×©×£ ×•×™×¨×˜×•××œ×™ ××•××—×”. ×ª×¤×§×™×“×š ×”×•× ×œ×™×™×¦×¨ ××ª×›×•×Ÿ ××œ× ×•××¤×•×¨×˜ (×›×•×œ×œ ×¨×›×™×‘×™×, ×”×•×¨××•×ª ×”×›× ×” ××“×•×™×§×•×ª, ×•×–××Ÿ ×”×›× ×”/×‘×™×©×•×œ) ×¢×œ ×‘×¡×™×¡ ×‘×§×©×ª ×”××©×ª××©.
×× ×”×‘×§×©×” ××™× ×” ×§×©×•×¨×” ×œ××ª×›×•×Ÿ, ××•×›×œ ××• ×”×›× ×” ×©×œ ×× ×” (×œ×“×•×’××”: "××” ××–×’ ×”××•×•×™×¨?" ××• "×©× ×©×œ ×—×‘×¨×”"), ×¢×œ×™×š ×œ×¢× ×•×ª ×‘×“×™×•×§: "×œ× × ××¦× ××ª×›×•×Ÿ ××ª××™× ×œ×‘×§×©×” ×–×•. ×× × ×”×–×Ÿ ×©× ×©×œ ×××›×œ, ×× ×” ××• ×¡×•×’ ××ª×›×•×Ÿ."
×× ×”××ª×›×•×Ÿ × ××¦×, ×¢×œ×™×• ×œ×”×™×•×ª ×× ×•×¡×— ×‘×©×¤×” ×§×œ×” ×•×‘×¨×•×¨×” ×•××•×¦×’ ×›-Markdown ×‘×¤×•×¨××˜ ×”×‘×:
# [×©× ×”××ª×›×•×Ÿ]
## ×–××Ÿ ×”×›× ×”: [X ×“×§×•×ª] / ×–××Ÿ ×‘×™×©×•×œ: [Y ×“×§×•×ª]
### ×¨×›×™×‘×™×
* [×›××•×ª] [×¨×›×™×‘]
* ...
### ×”×•×¨××•×ª ×”×›× ×”
1.  [×©×œ×‘ 1]
2.  [×©×œ×‘ 2]
...
×”×™×× ×¢ ××ª×•×›×Ÿ ××§×“×™× ××• ×¡×•×¤×™ ×©××™× ×• ×—×œ×§ ××”××ª×›×•×Ÿ ×¢×¦××•. ×”×©×‘ ×‘×¢×‘×¨×™×ª ×•×‘×¦×•×¨×” ××¤×•×¨×˜×ª.`;

            const systemPrompt = specificSystemPrompt || defaultSystemPrompt;
            const userQuery = specificSystemPrompt ? prompt : `×‘×‘×§×©×” ×¡×¤×§ ××ª×›×•×Ÿ ×¢×‘×•×¨: ${prompt}`;
            
            // ×©×™××•×© ×‘×›×œ×™ ×”×—×™×¤×•×© ×¨×§ ×¢×‘×•×¨ ×™×¦×™×¨×ª ××ª×›×•×Ÿ ×—×“×© ××• ×”×—×œ×¤×ª ×¨×›×™×‘×™× (×©×“×•×¨×© ×—×™×¤×•×© ×—×œ×•×¤×•×ª)
            const useSearch = !specificSystemPrompt || specificSystemPrompt.includes("×”×—×œ×£ ××ª ×”×¨×›×™×‘×™×") || specificSystemPrompt.includes("×’×¨×¡×” ×—×“×©×” ×•×©×•× ×”");

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                tools: useSearch ? [{ "google_search": {} }] : [],
                systemInstruction: { parts: [{ text: systemPrompt }] },
            };

            let response;
            let attempts = 0;
            const maxAttempts = 3;

            while (attempts < maxAttempts) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (response.ok) {
                        break;
                    } else if (response.status === 429) {
                        const delay = Math.pow(2, attempts) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        attempts++;
                    } else {
                        throw new Error(`×©×’×™××ª HTTP: ${response.status}`);
                    }
                } catch (error) {
                    console.error("×©×’×™××” ×‘×¨×©×ª ××• ×‘-API:", error);
                    const delay = Math.pow(2, attempts) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    attempts++;
                }
            }

            // ×”×¡×ª×¨×ª ××¦×‘ ×˜×¢×™× ×”
            btnText.textContent = '×—×¤×© ××ª×›×•×Ÿ';
            loader.classList.add('hidden');
            generateBtn.disabled = false;
            floatingAccessibilityBtn.disabled = false; // ×”×¤×¢×œ×ª ×”×›×¤×ª×•×¨ ×”×¦×£
            
            if (!response || !response.ok) {
                recipeOutput.innerHTML = `<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative" role="alert"><strong class="font-bold">×©×’×™××”!</strong><span class="block sm:inline"> ×œ× × ×™×ª×Ÿ ×”×™×” ×œ×™×¦×•×¨ ×§×©×¨ ×¢× ×”×©×£ ×”×•×™×¨×˜×•××œ×™. ×× × × ×¡×• ×©×•×‘ ×××•×—×¨ ×™×•×ª×¨.</span></div>`;
                return;
            }

            const result = await response.json();
            const candidate = result.candidates?.[0];

            if (candidate && candidate.content?.parts?.[0]?.text) {
                const text = candidate.content.parts[0].text.trim();
                
                // ×‘×“×™×§×” ×× ×”×‘×•×˜ ×¢× ×” ×‘×ª×©×•×‘×” ×”××¡×•×™××ª ×œ××™-××ª×›×•×Ÿ
                if (text === "×œ× × ××¦× ××ª×›×•×Ÿ ××ª××™× ×œ×‘×§×©×” ×–×•. ×× × ×”×–×Ÿ ×©× ×©×œ ×××›×œ, ×× ×” ××• ×¡×•×’ ××ª×›×•×Ÿ.") {
                    recipeOutput.innerHTML = `<p class="text-center text-red-500 font-medium p-4">âš ï¸ ${text}</p>`;
                    recipeActions.classList.add('hidden');
                    // ×œ× × ×©××•×¨ ×¤×¨×•××¤×˜ ×œ× ××•×¦×œ×—
                    return; 
                }
                
                let sources = [];
                const groundingMetadata = candidate.groundingMetadata;

                if (groundingMetadata && groundingMetadata.groundingAttributions) {
                    sources = groundingMetadata.groundingAttributions
                        .map(attribution => ({
                            uri: attribution.web?.uri,
                            title: attribution.web?.title,
                        }))
                        .filter(source => source.uri && source.title);
                }

                renderRecipe(text, sources);
                
                // ×¢×“×›×•×Ÿ ×”×¤×¨×•××¤×˜ ×”××•×¦×œ×— ×”××—×¨×•×Ÿ ×¨×§ ×× ×–×” ×™×¦×™×¨×ª ××ª×›×•×Ÿ ×—×“×©
                if (!specificSystemPrompt || specificSystemPrompt === defaultSystemPrompt) {
                     lastSuccessfulPrompt = prompt;
                }
                
                // ×”×¤×¢×œ×ª ×›×¤×ª×•×¨×™ ×”×¤×¢×•×œ×”
                copyBtn.disabled = false;
                shortenBtn.disabled = false;
                substituteToggleBtn.disabled = false;
                recipeActions.classList.remove('hidden');


            } else {
                recipeOutput.innerHTML = `<p class="text-center text-red-500 font-medium p-4">××¦×˜×¢×¨, ×œ× ×”×¦×œ×—×ª×™ ×œ××¦×•× ××ª×›×•×Ÿ ××ª××™×. ×× × × ×¡×” ×©××™×œ×ª×” ××—×¨×ª.</p>`;
                recipeActions.classList.add('hidden'); // ×”×¡×ª×¨×ª ×›×¤×ª×•×¨×™ ×”×¤×¢×•×œ×”
            }
        }

        // ×¤×•× ×§×¦×™×™×ª ×¢×™×‘×•×“ ×•×¨×™× ×“×•×¨ ×”××ª×›×•×Ÿ
        function renderRecipe(text, sources) {
            // ×©××™×¨×ª ×”×˜×§×¡×˜ ×”××§×•×¨×™ (Markdown) ×œ×”×¢×ª×§×”
            recipeOutput.dataset.markdown = text;

            const htmlContent = markdownToHtml(text);
            
            let sourcesHtml = '';
            if (sources.length > 0) {
                sourcesHtml = `<div class="mt-6 pt-4 border-t border-gray-200 text-sm text-gray-500">
                    <p class="font-semibold">××§×•×¨×•×ª:</p>
                    <ul class="list-disc pr-5 mt-2 space-y-1">
                        <p class="text-xs">×”××ª×›×•×Ÿ × ×•×¦×¨ ×¢×œ ×™×“×™ AI ×•××•×§×¨×§×¢ ×¢×œ ×™×“×™ ××§×•×¨×•×ª ×—×™×¤×•×©:</p>
                        ${sources.slice(0, 3).map(s => `<li><a href="${s.uri}" target="_blank" class="text-pink-500 hover:text-pink-700">${s.title}</a></li>`).join('')}
                    </ul>
                </div>`;
            }

            recipeOutput.innerHTML = htmlContent + sourcesHtml;
        }


        // --- ××˜×¤×œ×™× ×‘×¤×¢×•×œ×•×ª ×©×•× ×•×ª ---

        // 1. ×”×¢×ª×§×ª ××ª×›×•×Ÿ
        function handleCopy() {
            const recipeText = recipeOutput.dataset.markdown;
            if (recipeText) {
                const tempTextArea = document.createElement('textarea');
                tempTextArea.value = recipeText;
                document.body.appendChild(tempTextArea);
                tempTextArea.select();
                try {
                    // ×©×™××•×© ×‘-execCommand ×œ×¢×‘×•×“×” ×‘×¡×‘×™×‘×ª iFrame
                    document.execCommand('copy'); 
                    showMessage("×”××ª×›×•×Ÿ ×”×•×¢×ª×§ ×‘×”×¦×œ×—×”!");
                } catch (err) {
                    showMessage("×©×’×™××ª ×”×¢×ª×§×”. ×× × × ×¡×” ×œ×”×¢×ª×™×§ ×™×“× ×™×ª.", true);
                    console.error('Copy failed:', err);
                } finally {
                    document.body.removeChild(tempTextArea);
                }
            }
        }

        // 2. ×§×™×¦×•×¨ ××ª×›×•×Ÿ
        function handleShorten() {
            if (!lastSuccessfulPrompt) {
                 showMessage("×× × ×¦×•×¨ ××ª×›×•×Ÿ ×§×•×“× ×œ×¤× ×™ ×”×§×™×¦×•×¨.", true);
                 return;
            }
            const shortenPrompt = `×‘×‘×§×©×” ×§×¦×¨ ××ª ×”××ª×›×•×Ÿ ×”×‘×, ×©××•×¨ ×¢×œ ×©×œ×‘×™ ×”×”×›× ×” ×”×—×©×•×‘×™× ××š ×¤×©×˜ ××ª ×”×©×¤×” ×•×”×¡×¨ ×¤×¨×˜×™× ××™×•×ª×¨×™×: ×”××ª×›×•×Ÿ ×”×•× ×¢×‘×•×¨: ${lastSuccessfulPrompt}`;
            const shortenSystemPrompt = `××ª×” ×©×£ ×•×™×¨×˜×•××œ×™. ×ª×¤×§×™×“×š ×”×•× ×œ×§×¦×¨ ××ª ×”××ª×›×•×Ÿ ×”××‘×•×§×©. ×©××•×¨ ×¢×œ ×¤×•×¨××˜ Markdown ×”××§×•×¨×™: #, ##, ### ×•×¨×©×™××•×ª ××¡×•×“×¨×•×ª ×•×œ× ××¡×•×“×¨×•×ª. ×”×©×‘ ×‘×¢×‘×¨×™×ª.`;
            callGeminiApi(shortenPrompt, shortenSystemPrompt);
        }
        
        // 3. ×”×¦×’×ª ×©×•×¨×ª ×”×—×œ×¤×ª ×¨×›×™×‘×™× (×‘××§×•× ×”×›×¤×ª×•×¨ ×”××§×•×¨×™)
        function toggleSubstituteInput() {
            if (!lastSuccessfulPrompt) {
                showMessage("×× × ×¦×•×¨ ××ª×›×•×Ÿ ×§×•×“× ×œ×¤× ×™ ×”×—×œ×¤×ª ×¨×›×™×‘×™×.", true);
                return;
            }

            const isHidden = substituteInputContainer.classList.contains('hidden');
            if (isHidden) {
                substituteInputContainer.classList.remove('hidden');
                substituteInputContainer.classList.add('slide-in');
            } else {
                substituteInputContainer.classList.add('hidden');
                substituteInputContainer.classList.remove('slide-in');
            }
        }

        // 4. ×©×œ×™×—×ª ×‘×§×©×ª ×”×—×œ×¤×ª ×¨×›×™×‘×™× (×›×¤×ª×•×¨ ×¡×’×•×œ)
        function handleSubmitSubstitution() {
            const exclusionText = substitutionInput.value.trim();
            if (!exclusionText) {
                showMessage("×× × ×”×–×Ÿ ××™×œ×• ×¨×›×™×‘×™× ×ª×¨×¦×” ×œ×”×—×œ×™×£ ××• ×œ×©× ×•×ª.", true);
                return;
            }
            
            const substitutePrompt = `×‘×‘×§×©×” ×¡×¤×§ ×’×¨×¡×” ×—×“×©×” ×œ××ª×›×•×Ÿ ×¢×‘×•×¨: ${lastSuccessfulPrompt}. ×”××ª×›×•×Ÿ ×”×—×“×© ×¦×¨×™×š ×œ×”×ª××™× ×œ×‘×§×©×” ×”×‘××”: ${exclusionText}`;
            const substituteSystemPrompt = `××ª×” ×©×£ ×•×™×¨×˜×•××œ×™ ××•××—×” ×‘×”×ª×××ª ××ª×›×•× ×™× ×œ×ª×–×•× ×” ××™×•×—×“×ª (×˜×‘×¢×•× ×™, ×œ×œ× ×’×œ×•×˜×Ÿ, ×“×œ ×©×•××Ÿ ×•×›×•'). ×¢×œ×™×š ×œ×¡×¤×§ ×’×¨×¡×” ×—×“×©×” ×•××œ××” ×©×œ ×”××ª×›×•×Ÿ ×”××§×•×¨×™ ×¢× ×¨×›×™×‘×™× ×—×œ×•×¤×™×™× ×”×ª×•×××™× ×œ×‘×§×©×ª ×”××©×ª××©. ×”××ª×›×•×Ÿ ×”×—×“×© ×—×™×™×‘ ×œ×©××•×¨ ×¢×œ ×¤×•×¨××˜ Markdown ×”××§×•×¨×™: #, ##, ### ×•×¨×©×™××•×ª ××¡×•×“×¨×•×ª ×•×œ× ××¡×•×“×¨×•×ª. ×¦×™×™×Ÿ ×‘×›×•×ª×¨×ª ××ª ×”×©×™× ×•×™ ×©×‘×•×¦×¢ (×œ×“×•×’××”: ××ª×›×•×Ÿ ×¤× ×§×™×™×§ ×œ×œ× ×’×œ×•×˜×Ÿ). ×”×©×‘ ×‘×¢×‘×¨×™×ª.`;
            
            // × ×¡×ª×¨ ××ª ×©×•×¨×ª ×”×”×—×œ×¤×” ×œ××—×¨ ×©×œ×™×—×”
            substituteInputContainer.classList.add('hidden');
            callGeminiApi(substitutePrompt, substituteSystemPrompt);
        }

        // 5. ××¦×™××ª ××ª×›×•×Ÿ ××—×¨ ×œ××•×ª×” ×× ×” (×›×¤×ª×•×¨ ×•×¨×•×“)
        function handleSwapRecipe() {
            if (!lastSuccessfulPrompt) {
                 showMessage("×× × ×¦×•×¨ ××ª×›×•×Ÿ ×§×•×“×.", true);
                 return;
            }

            const swapPrompt = `×‘×‘×§×©×” ×¡×¤×§ ××ª×›×•×Ÿ ×—×“×© ×•×©×•× ×” ×œ××•×ª×• ×¡×•×’ ×× ×”: ${lastSuccessfulPrompt}. × ×¡×” ×œ×©× ×•×ª ××ª ×”×¡×’× ×•×Ÿ, ×”××˜×‘×— ××• ××•×¤×™ ×”×× ×”. ×œ×“×•×’××”, ×× ×”××ª×›×•×Ÿ ×”×•× ×œ×¢×•×’×ª ×©×•×§×•×œ×“, ×¡×¤×§ ××ª×›×•×Ÿ ×œ×‘×¨××•× ×™×– ×©×•×§×•×œ×“ ××• ××•×¡ ×©×•×§×•×œ×“.`;
            const swapSystemPrompt = `××ª×” ×©×£ ×•×™×¨×˜×•××œ×™. ×ª×¤×§×™×“×š ×”×•× ×œ×¡×¤×§ ×’×¨×¡×” ×—×“×©×” ×•×©×•× ×”, ××š ×§×©×•×¨×”, ×©×œ ×”××ª×›×•×Ÿ ×”××§×•×¨×™. ×”××ª×›×•×Ÿ ×”×—×“×© ×—×™×™×‘ ×œ×©××•×¨ ×¢×œ ×¤×•×¨××˜ Markdown ×”××§×•×¨×™: #, ##, ### ×•×¨×©×™××•×ª ××¡×•×“×¨×•×ª ×•×œ× ××¡×•×“×¨×•×ª. ×¦×™×™×Ÿ ×‘×›×•×ª×¨×ª ××ª ×”×©×™× ×•×™ ×©×‘×•×¦×¢. ×”×©×‘ ×‘×¢×‘×¨×™×ª.`;
            
            // × ×¡×ª×¨ ××ª ×©×•×¨×ª ×”×”×—×œ×¤×” ×œ××—×¨ ×©×œ×™×—×”
            substituteInputContainer.classList.add('hidden');
            callGeminiApi(swapPrompt, swapSystemPrompt);
        }

        // --- 6. ×¤×•× ×§×¦×™×•×ª × ×’×™×©×•×ª ---
        
        function updateFontSizeText() {
            let text;
            if (fontSizeScale === 1.0) text = '×¨×’×™×œ';
            else if (fontSizeScale === 1.15) text = '×’×“×•×œ';
            else if (fontSizeScale === 1.3) text = '×’×“×•×œ ×××•×“';
            currentFontSizeSpan.textContent = text;
        }

        function applyAccessibilitySettings() {
            const body = document.body;
            
            // 1. × ×™×’×•×“×™×•×ª
            if (isHighContrast) {
                body.classList.add('accessibility-mode');
                toggleContrastBtn.textContent = '×‘×˜×œ × ×™×’×•×“×™×•×ª ×’×‘×•×”×”';
            } else {
                body.classList.remove('accessibility-mode');
                toggleContrastBtn.textContent = '×”×¤×¢×œ × ×™×’×•×“×™×•×ª ×’×‘×•×”×”';
            }

            // 2. ×”×“×’×©×ª ×§×™×©×•×¨×™×
            if (isLinkHighlight) {
                body.classList.add('highlight-links');
                toggleLinkHighlightBtn.textContent = '×‘×˜×œ ×”×“×’×©×”';
            } else {
                body.classList.remove('highlight-links');
                toggleLinkHighlightBtn.textContent = '×”×¤×¢×œ ×”×“×’×©×”';
            }
            
            // 3. ×’×•×“×œ ×’×•×¤×Ÿ
            body.style.fontSize = `${fontSizeScale}rem`;
            updateFontSizeText();
        }
        
        function handleToggleContrast() {
            isHighContrast = !isHighContrast;
            applyAccessibilitySettings();
            showMessage(isHighContrast ? "×”×•×¤×¢×œ×” × ×™×’×•×“×™×•×ª ×’×‘×•×”×” (×”×™×¤×•×š ×¦×‘×¢×™×)." : "×‘×•×˜×œ×” × ×™×’×•×“×™×•×ª ×’×‘×•×”×”.");
        }
        
        function handleToggleLinkHighlight() {
            isLinkHighlight = !isLinkHighlight;
            applyAccessibilitySettings();
            showMessage(isLinkHighlight ? "×”×•×¤×¢×œ×” ×”×“×’×©×ª ×§×™×©×•×¨×™×." : "×‘×•×˜×œ×” ×”×“×’×©×ª ×§×™×©×•×¨×™×.");
        }

        function handleTextResize(increase) {
            const oldScale = fontSizeScale;
            if (increase) {
                if (fontSizeScale < 1.3) {
                    fontSizeScale += 0.15;
                } else {
                    showMessage("×”×’×¢×ª ×œ×’×•×“×œ ×”×’×•×¤×Ÿ ×”××§×¡×™××œ×™.", true);
                    return;
                }
            } else {
                if (fontSizeScale > 1.0) {
                    fontSizeScale -= 0.15;
                } else {
                    showMessage("×”×’×¢×ª ×œ×’×•×“×œ ×”×’×•×¤×Ÿ ×”××™× ×™××œ×™ (×¨×’×™×œ).", true);
                    return;
                }
            }
            fontSizeScale = parseFloat(fontSizeScale.toFixed(2));
            applyAccessibilitySettings();
            showMessage(`×’×•×“×œ ×’×•×¤×Ÿ ×©×•× ×” ×œ- ${currentFontSizeSpan.textContent}.`);
        }
        
        function handleResetAccessibility() {
            isHighContrast = false;
            isLinkHighlight = false;
            fontSizeScale = 1.0;
            applyAccessibilitySettings();
            showMessage("×”×’×“×¨×•×ª ×”× ×’×™×©×•×ª ××•×ª×—×œ×•.");
            hideAccessibilityModal();
        }

        function showAccessibilityModal() {
            // ×•×“× ×©×”×›×¤×ª×•×¨×™× ×‘××•×“×œ ××©×§×¤×™× ××ª ×”××¦×‘ ×”× ×•×›×—×™ ×œ×¤× ×™ ×”×¤×ª×™×—×”
            applyAccessibilitySettings();
            accessibilitySettingsModal.style.display = 'flex';
        }

        function hideAccessibilityModal() {
            accessibilitySettingsModal.style.display = 'none';
        }
        
        // --- 7. ×¤×•× ×§×¦×™×•×ª ×¢×•×’×™×•×ª ×•××©×¤×˜×™×•×ª ---
        
        function showModal(modalElement) {
            // ×¡×’×™×¨×ª ×›×œ ××•×“×œ ××—×¨ ×¤×ª×•×— ×œ×¤× ×™ ×¤×ª×™×—×ª ×—×“×©, ××œ×‘×“ ×”××•×“×œ ×”××§×™×£
            const allModals = [aboutCookiesModal, termsOfUseModal, privacyPolicyModal, medicalDisclaimerModal, aiAssuranceModal];
            allModals.forEach(modal => {
                if (modal !== modalElement) {
                    modal.style.display = 'none';
                }
            });
            modalElement.style.display = 'flex';
        }

        function hideModal(modalElement) {
            modalElement.style.display = 'none';
        }
        
        // ×¤×•× ×§×¦×™×•×ª ××•×“×œ×™× ××©×¤×˜×™×™×
        function handleOpenLegalModal(e) {
            e.preventDefault();
            const modalType = e.currentTarget.getAttribute('data-modal') || e.currentTarget.getAttribute('data-link');

            switch (modalType) {
                case 'terms-of-use':
                    showModal(termsOfUseModal);
                    break;
                case 'privacy-policy':
                    showModal(privacyPolicyModal);
                    break;
                case 'disclaimer':
                    showModal(medicalDisclaimerModal);
                    break;
                case 'ai-assurance':
                    showModal(aiAssuranceModal);
                    break;
                case 'accessibility-statement': // ×”×¦×”×¨×ª × ×’×™×©×•×ª ×¤×•×ª×—×ª ××ª ××•×“×œ ×”× ×’×™×©×•×ª
                    showAccessibilityModal();
                    break;
                default:
                    console.error("Unknown modal type:", modalType);
            }
        }
        
        function hideDisclaimerModal(e) {
            // ×¡×’×™×¨×ª ××•×“×œ ×”××™×©×•×¨ ×”××§×™×£
            if (e.currentTarget.id === 'close-disclaimer-btn') {
                disclaimerAccepted = true;
                mainDisclaimerModal.style.display = 'none';
                
                // ×”×¤×¢×œ×ª ×”×—×™×¤×•×© ×©×”×•×©×”×”, ×× ×™×©
                const prompt = recipeInput.value.trim();
                // × ×©×ª××© ×‘×¢×¨×š ×©× ×©××¨ ×§×•×“× ×œ×›×Ÿ ×‘×¤×•× ×§×¦×™×™×ª callGeminiApi
                if (prompt) {
                    callGeminiApi(prompt);
                }
            } else {
                 mainDisclaimerModal.style.display = 'none';
            }
        }


        function updateAccessibilityButtonPosition(isOpen) {
            if (isOpen) {
                floatingAccessibilityBtn.style.bottom = ACCESSIBILITY_BOTTOM_ABOVE_COOKIE;
            } else {
                floatingAccessibilityBtn.style.bottom = ACCESSIBILITY_BOTTOM_DEFAULT;
            }
        }

        function handleBannerConsent() {
            consentGiven = true;
            showMessage("×”××©×š ×’×œ×™×©×” ×××©×¨ ×”×¡×›××” ×œ×¢×•×’×™×•×ª.", false);
            cookieBanner.classList.add('hidden');
            updateAccessibilityButtonPosition(false); // ×”×—×–×¨×ª ×›×¤×ª×•×¨ ×”× ×’×™×©×•×ª ×œ××™×§×•× ×¨×’×™×œ
        }
        
        function checkCookieConsent() {
            // ×× ××™×Ÿ ×”×¡×›××”, ×”×¦×’ ××ª ×”×‘×× ×¨ ×‘×›× ×™×¡×” ×œ××ª×¨
            if (!consentGiven) {
                cookieBanner.classList.remove('hidden');
                updateAccessibilityButtonPosition(true); // ×”×¢×œ××ª ×›×¤×ª×•×¨ ×”× ×’×™×©×•×ª ××¢×œ ×”×‘×× ×¨
            }
        }
        
        // --- 8. ×¤×•× ×§×¦×™×™×ª ××ª×—×•×œ ×›×¤×ª×•×¨×™× ××§×¨××™×™× ×•-Placeholder ---
        function initializeQuickButtons() {
            // ×¤×•× ×§×¦×™×™×ª ×¢×¨×‘×•×‘ (Shuffle) ×©×œ ××¢×¨×š
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            // ×¢×¨×‘×•×‘ ×•×¡×™××•×Ÿ 4 ××ª×›×•× ×™×
            shuffleArray(RECIPE_POOL);
            const selectedRecipes = RECIPE_POOL.slice(0, 4);

            let buttonsHtml = '';
            selectedRecipes.forEach(item => {
                buttonsHtml += `<button data-recipe="${item.recipe}" class="recipe-btn bg-pink-500 hover:bg-pink-700 text-white font-bold py-3 px-6 shadow-xl">${item.text}</button>`;
            });

            quickButtonsContainer.innerHTML = buttonsHtml;

            // ×—×™×‘×•×¨ ××—×“×© ×©×œ ×”-Event Listeners ×œ×›×¤×ª×•×¨×™× ×”×—×“×©×™×
            const newQuickButtons = quickButtonsContainer.querySelectorAll('.recipe-btn');
            newQuickButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    const prompt = e.currentTarget.getAttribute('data-recipe');
                    if (prompt) {
                        // ×©××™×¨×ª ×”×¢×¨×š ×‘×©×“×” ×”×§×œ×˜ ×œ×¤× ×™ ×”×§×¨×™××” ×œ-API (×©×¢×©×•×™×” ×œ×”×™×¢×¦×¨ ×¢×œ ×™×“×™ ×”××•×“×œ ×”××©×¤×˜×™)
                        recipeInput.value = prompt; 
                        if (disclaimerAccepted) {
                            callGeminiApi(prompt);
                        } else {
                            mainDisclaimerModal.style.display = 'flex';
                        }
                    }
                });
            });
        }
        
        // ×¤×•× ×§×¦×™×™×ª ×”×—×œ×¤×ª ×”-placeholder ×‘××•×¤×Ÿ ××•×˜×•××˜×™
        let currentPlaceholderIndex = 0;
        function updatePlaceholder() {
            recipeInput.placeholder = `×œ×“×•×’××”: ${PLACEHOLDER_POOL[currentPlaceholderIndex]}`;
            currentPlaceholderIndex = (currentPlaceholderIndex + 1) % PLACEHOLDER_POOL.length;
        }


        // --- ×”×˜××¢×ª Event Listeners ---
        
        // ×”×¤×¢×œ×ª ×”×’×“×¨×•×ª × ×’×™×©×•×ª ×¨××©×•× ×™×•×ª
        applyAccessibilitySettings();
        
        // ××ª×—×•×œ ×›×¤×ª×•×¨×™ ×”××ª×›×•× ×™× ×”××§×¨××™×™×
        initializeQuickButtons();
        
        // ×”×¤×¢×œ×ª ×”×—×œ×¤×ª ×”-placeholder ×•×˜×™×™××¨
        updatePlaceholder();
        setInterval(updatePlaceholder, 4000); 


        // ××˜×¤×œ ×‘×œ×—×™×¦×” ×¢×œ ×›×¤×ª×•×¨ "×—×¤×© ××ª×›×•×Ÿ" 
        generateBtn.addEventListener('click', () => {
            const prompt = recipeInput.value.trim();
            if (prompt) {
                if (disclaimerAccepted) {
                    callGeminiApi(prompt);
                } else {
                    // ×× ×œ× ××•×©×¨, ×¤×ª×— ××ª ×”××•×“×œ ×•×¦×. ×”×—×™×¤×•×© ×™×ª×‘×¦×¢ ×œ××—×¨ ×”××™×©×•×¨.
                    recipeInput.value = prompt; // ×©××™×¨×ª ×”×¤×¨×•××¤×˜
                    mainDisclaimerModal.style.display = 'flex'; 
                }
            } else {
                showMessage("×× × ×”×§×œ×“ ××ª ×©× ×”××ª×›×•×Ÿ ×©××ª×” ××—×¤×© ××• ×‘×—×¨ ××ª×¤×¨×™×˜ ×”×›×¤×ª×•×¨×™×.", true);
            }
        });


        // ×××¤×©×¨ ×©×œ×™×—×” ×‘×××¦×¢×•×ª Enter ×‘×©×“×” ×”×§×œ×˜ ×”×¨××©×™
        recipeInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                generateBtn.click();
            }
        });

        // ××˜×¤×œ×™ ×¤×¢×•×œ×•×ª
        copyBtn.addEventListener('click', handleCopy);
        shortenBtn.addEventListener('click', handleShorten);
        
        // ××˜×¤×œ×™ × ×’×™×©×•×ª ×¦×¤×™×
        floatingAccessibilityBtn.addEventListener('click', showAccessibilityModal);
        toggleContrastBtn.addEventListener('click', handleToggleContrast);
        toggleLinkHighlightBtn.addEventListener('click', handleToggleLinkHighlight); 
        increaseTextBtn.addEventListener('click', () => handleTextResize(true));
        decreaseTextBtn.addEventListener('click', () => handleTextResize(false));
        resetAccessibilityBtn.addEventListener('click', handleResetAccessibility); 
        closeAccessibilityBtn.addEventListener('click', hideAccessibilityModal);
        accessibilitySettingsModal.addEventListener('click', (e) => { // ×¡×’×™×¨×ª ××•×“×œ ×‘×œ×—×™×¦×” ××—×•×¥ ×œ×ª×•×›×Ÿ
            if (e.target === accessibilitySettingsModal) {
                hideAccessibilityModal();
            }
        });
        
        // ××˜×¤×œ×™ ×‘×× ×¨ ×¢×•×’×™×•×ª
        closeCookieBannerBtn.addEventListener('click', handleBannerConsent); // ×œ×—×™×¦×” ×¢×œ "×× ×™ ××¡×›×™×/×”"
        readMoreLink.addEventListener('click', (e) => { // ×œ×—×™×¦×” ×¢×œ "×§×¨× ×¢×•×“"
            e.preventDefault();
            showModal(aboutCookiesModal);
        });
        
        // ××˜×¤×œ×™ ××•×“×œ "×§×¨× ×¢×•×“"
        closeAboutCookiesBtn.addEventListener('click', () => hideModal(aboutCookiesModal));
        aboutCookiesModal.addEventListener('click', (e) => { // ×¡×’×™×¨×ª ××•×“×œ ×‘×œ×—×™×¦×” ××—×•×¥ ×œ×ª×•×›×Ÿ
            if (e.target === aboutCookiesModal) {
                hideModal(aboutCookiesModal);
            }
        });

        // ×›×¤×ª×•×¨ ×”×—×œ×£ ×¨×›×™×‘×™× (×”×˜×•×’×œ)
        substituteToggleBtn.addEventListener('click', toggleSubstituteInput);
        
        // ×›×¤×ª×•×¨ ×”×—×œ×£ ×¨×›×™×‘×™× (×©×œ×™×—×”)
        submitSubstitutionBtn.addEventListener('click', handleSubmitSubstitution);

        // ×›×¤×ª×•×¨ ××ª×›×•×Ÿ ××—×¨ ×œ××•×ª×” ×× ×”
        swapRecipeBtn.addEventListener('click', handleSwapRecipe);

        // ×©×œ×™×—×” ××©×•×¨×ª ×”×§×œ×˜ ×©×œ ×”×—×œ×¤×ª ×¨×›×™×‘×™× ×‘×××¦×¢×•×ª Enter
        substitutionInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                handleSubmitSubstitution();
            }
        });
        
        // --- ××˜×¤×œ×™ ×”××™×©×•×¨ ×”××§×™×£ (disclaimer-modal) ---
        closeDisclaimerBtn.addEventListener('click', hideDisclaimerModal); // ××™×©×•×¨ ×¡×•×¤×™
        mainDisclaimerModal.addEventListener('click', (e) => { // ×¡×’×™×¨×ª ××•×“×œ ×‘×œ×—×™×¦×” ××—×•×¥ ×œ×ª×•×›×Ÿ
            if (e.target === mainDisclaimerModal) {
                // ×œ× ×××¤×©×¨×™× ×œ×¡×’×•×¨ ×‘×œ×™ ××™×©×•×¨
            }
        });
        
        // ××˜×¤×œ×™ ×›×¤×ª×•×¨×™ ×”××•×“×œ×™× ×‘×ª×•×š ×”××•×“×œ ×”××§×™×£ ×•×§×™×©×•×¨×™ ×”×¤×•×˜×¨
        const allLegalLinks = [...disclaimerLinkBtns, ...footerLinks];
        allLegalLinks.forEach(link => {
            link.addEventListener('click', handleOpenLegalModal);
        });
        
        // ××˜×¤×œ×™ ×›×¤×ª×•×¨×™ ×”×¡×’×™×¨×” ×©×œ ×”××•×“×œ×™× ×”××¤×•×¨×˜×™×
        closeModalBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const modalId = e.currentTarget.closest('.modal-overlay').id;
                hideModal(document.getElementById(modalId));
            });
        });

        // ×”×¤×¢×œ×ª ×‘×“×™×§×ª ×”×¢×•×’×™×•×ª ×œ××—×¨ ×˜×¢×™× ×ª ×”×“×£
        window.onload = checkCookieConsent;
    </script>
</body>
</html>
